!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports,require("@angular/core"),require("rxjs/operators"),require("redux"),require("rxjs")):"function"==typeof define&&define.amd?define("@angular-redux/store",["exports","@angular/core","rxjs/operators","redux","rxjs"],e):e(((t=t||self)["angular-redux"]=t["angular-redux"]||{},t["angular-redux"].store={}),t.ng.core,t.rxjs.operators,t.redux,t.rxjs)}(this,(function(t,e,n,r,o){"use strict";var i=function(t,e){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(t,e)};var u=function(){return(u=Object.assign||function(t){for(var e,n=1,r=arguments.length;n<r;n++)for(var o in e=arguments[n])Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o]);return t}).apply(this,arguments)};function c(t,e,n,r){var o,i=arguments.length,u=i<3?e:null===r?r=Object.getOwnPropertyDescriptor(e,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)u=Reflect.decorate(t,e,n,r);else for(var c=t.length-1;c>=0;c--)(o=t[c])&&(u=(i<3?o(u):i>3?o(e,n,u):o(e,n))||u);return i>3&&u&&Object.defineProperty(e,n,u),u}function a(t,e){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(t,e)}function s(t,e){var n="function"==typeof Symbol&&t[Symbol.iterator];if(!n)return t;var r,o,i=n.call(t),u=[];try{for(;(void 0===e||e-- >0)&&!(r=i.next()).done;)u.push(r.value)}catch(t){o={error:t}}finally{try{r&&!r.done&&(n=i.return)&&n.call(i)}finally{if(o)throw o.error}}return u}function f(){for(var t=[],e=0;e<arguments.length;e++)t=t.concat(s(arguments[e]));return t}var l=function(){function t(){}return t.instance=void 0,t}(),d="undefined"!=typeof window?window:{},p=function(){function t(t,n){var r=this;this.appRef=t,this.ngRedux=n,this.enhancer=function(t){var n;return r.isEnabled()?(r.getDevTools().listen((function(t){var o=t.type;"START"===o?n=r.ngRedux.subscribe((function(){e.NgZone.isInAngularZone()||r.appRef.tick()})):"STOP"===o&&n()})),r.getDevTools()(t||{})):null},this.isEnabled=function(){return!!r.getDevTools()},this.getDevTools=function(){return d&&(d.__REDUX_DEVTOOLS_EXTENSION__||d.devToolsExtension)}}return t.ctorParameters=function(){return[{type:e.ApplicationRef},{type:l}]},t=c([e.Injectable(),a("design:paramtypes",[e.ApplicationRef,l])],t)}();function g(t,e){if(!t)return t;if("function"==typeof t.getIn)return t.getIn(e);var n=s(e),r=n[0],o=n.slice(1);return void 0!==t[r]?0===o.length?t[r]:g(t[r],o):void 0}var h=function(t,e,n){var r,o,i=s(e),c=i[0],a=i.slice(1);return"function"==typeof(t[c]||{}).setIn?u({},t,((r={})[c]=t[c].setIn(a,n),r)):u({},t,((o={})[c]=0===a.length?n:h(t[c]||{},a,n),o))},v={},b=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return function(e,n){return t.reduce((function(t,e){return e(t,n)}),e)}};function y(t){return v={},b(S,t)}function S(t,e){void 0===t&&(t={});var n=e["@angular-redux::fractalkey"],r=n?JSON.parse(n):[],o=v[n||""];return n&&o?h(t,r,o(g(t,r),e)):t}var x="@angular-redux::substore::class::options",O="@angular-redux::substore::instance::selections",R="@angular-redux::substore::instance::basepath",w=function(t){return t.constructor[x]},j=function(t,e){t[x]=e},m=function(t,e){return t["@angular-redux::substore::instance::store"]=e},P=function(t){return t["@angular-redux::substore::instance::store"]},_=function(t){var e=t[O]||{};return t[O]=e,e},N=function(t,e){return t[R]!==(e||[]).toString()},T=function(t,e){t[R]=(e||[]).toString()},E=function(t){t[O]=null,t["@angular-redux::substore::instance::store"]=null,t[R]=null},D=function(t){if(l.instance){var e=w(t);if(!e)return l.instance;var n=t[e.basePathMethodName]();return N(t,n)&&(E(t),T(t,n)),n?(P(t)||m(t,l.instance.configureSubStore(n,e.localReducer)),P(t)):l.instance}},A=function(t,e,r,o,i){var u=D(t);if(u){var c=_(t);return c[e]=c[e]||(o?u.select(r).pipe((function(e){return o(e,t)}),n.distinctUntilChanged(i)):u.select(r,i)),c[e]}};function I(t,e,n){return function(r,o){delete r[o]&&Object.defineProperty(r,o,{get:function(){return A(this,o,t,e,n)},enumerable:!0,configurable:!0})}}var M=function(t,e){if(!t)throw new Error(e)},Z=function(t){return function(t){return{property:function(e){return e?e[t]:void 0},path:function(e){return g(e,t)},function:t,nil:function(t){return t}}}(t)[function(t){return t?Array.isArray(t)?"path":"function"==typeof t?"function":"property":"nil"}(t)]},k=function t(e,r,o){var i=this;this.rootStore=e,this.basePath=r,this.dispatch=function(t){return i.rootStore.dispatch(u({},t,{"@angular-redux::fractalkey":JSON.stringify(i.basePath)}))},this.getState=function(){return g(i.rootStore.getState(),i.basePath)},this.configureSubStore=function(e,n){return new t(i.rootStore,f(i.basePath,e),n)},this.select=function(t,e){return i.rootStore.select(i.basePath).pipe(n.map(Z(t)),n.distinctUntilChanged(e))},this.subscribe=function(t){var e=i.select().subscribe(t);return function(){return e.unsubscribe()}},this.replaceReducer=function(t){return function(t,e){v[JSON.stringify(t)]=e}(i.basePath,t)},function(t,e){var n=v[JSON.stringify(t)];if(n&&n!==e)throw new Error("attempt to overwrite fractal reducer for basePath "+t);v[JSON.stringify(t)]=e}(r,o)},q=function(t){function u(i){var u=t.call(this)||this;return u.ngZone=i,u.store=void 0,u.configureStore=function(t,e,n,o){void 0===n&&(n=[]),void 0===o&&(o=[]),M(!u.store,"Store already configured!"),u.setStore(r.compose.apply(void 0,f([r.applyMiddleware.apply(void 0,f(n))],o))(r.createStore)(y(t),e))},u.provideStore=function(t){M(!u.store,"Store already configured!"),u.setStore(t)},u.getState=function(){return u.store.getState()},u.subscribe=function(t){return u.store.subscribe(t)},u.replaceReducer=function(t){u.store.replaceReducer(t)},u.dispatch=function(t){return M(!!u.store,"Dispatch failed: did you forget to configure your store? https://github.com/angular-redux/platform/blob/master/packages/store/README.md#quick-start"),e.NgZone.isInAngularZone()?u.store.dispatch(t):u.ngZone.run((function(){return u.store.dispatch(t)}))},u.select=function(t,e){return u.store$.pipe(n.distinctUntilChanged(),n.map(Z(t)),n.distinctUntilChanged(e))},u.configureSubStore=function(t,e){return new k(u,t,e)},u.storeToObservable=function(t){return new o.Observable((function(e){e.next(t.getState());var n=t.subscribe((function(){return e.next(t.getState())}));return function(){n(),e.complete()}}))},l.instance=u,u.store$=new o.BehaviorSubject(void 0).pipe(n.filter((function(t){return void 0!==t})),n.switchMap((function(t){return t}))),u}return function(t,e){function n(){this.constructor=t}i(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)}(u,t),u.prototype.setStore=function(t){this.store=t;var e=this.storeToObservable(t);this.store$.next(e)},u}(l);function J(t){return new q(t)}var U=function(){function t(){}return t=c([e.NgModule({providers:[p,{provide:l,useFactory:J,deps:[e.NgZone]}]})],t)}();t.DevToolsExtension=p,t.NgRedux=l,t.NgReduxModule=U,t.WithSubStore=function(t){var e=t.basePathMethodName,n=t.localReducer;return function(t){j(t,{basePathMethodName:e,localReducer:n})}},t._ngReduxFactory=J,t.dispatch=function(){return function(t,e,n){var r,o=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];var n=r.apply(this,t);if(void 0!==n){var o=D(this)||l.instance;o&&o.dispatch(n)}return n};if(void 0===(n=n||Object.getOwnPropertyDescriptor(t,e))){var i={get:function(){return o},set:function(t){return r=t}};return Object.defineProperty(t,e,i),i}return r=n.value,n.value=o,n}},t.enableFractalReducers=y,t.select=function(t,e){return function(n,r){I(t||(String(r).lastIndexOf("$")===String(r).length-1?String(r).substring(0,String(r).length-1):r),void 0,e)(n,r)}},t.select$=function(t,e,n){return I(t,e,n)},t.Éµa=q,Object.defineProperty(t,"__esModule",{value:!0})}));
//# sourceMappingURL=angular-redux-store.umd.min.js.map